{"componentChunkName":"component---src-components-blog-post-js","path":"/blog/automation-with-windows-com/","result":{"data":{"site":{"siteMetadata":{"title":"Mayank Raj"}},"markdownRemark":{"id":"b66bb1fa-737a-5f89-adef-7aa4bd6a5bdf","excerpt":"A few weeks ago I got a project wherein I had to get various statistical data about a document. One of the important parameters was to get a precise count ofâ€¦","html":"<p>A few weeks ago I got a project wherein I had to get various statistical data about a document. One of the important parameters was to get a precise count of grammatical errors in the document. I tried to go the open source way and tested out <a href=\"https://www.languagetool.org/\">LanguageTool</a>, <a href=\"http://proselint.com/\">PorseLink</a> among others. None of these were up to the mark of the good old MS-Word.\nSo I had to now work on a way to problematically access Word, load a document in it and get the statistics.</p>\n<p>Python being versatile and great at memory management, we would be using it to control COM object and do what we need to do.</p>\n<hr>\n<p>This is the Part 1 of the two series post.</p>\n<p><strong>Part 1</strong> : Introduction to <code>COMobject</code>, initialization, examples etc</p>\n<p><strong>Part 2</strong> : Setting up a server environment. Making use of threads and opening using thread for each process. This is how to communicate with the <code>COMobject</code> in a multi-thread environment as it cannot be passed to a thread directly.</p>\n<hr>\n<h1>Before we dig deep, what is COMobject ?</h1>\n<blockquote>\n<p>The Microsoft Component Object Model (COM) is a platform-independent, distributed, object-oriented system for creating binary software components that can interact. COM is the foundation technology for Microsoft's OLE (compound documents), ActiveX (Internet-enabled components), as well as others. <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms694363(v=vs.85).aspx\">read more...</a></p>\n</blockquote>\n<p>In a nutshell it can be used to control various aspects of Windows. We would be focusing on using the <code>COMobject</code> to control MS-Office applications like Word and Excel. Although it is not limited to just MS-Office applications, it can be used to communicate with other softwares like IE (if you're still into it...)</p>\n<p>You can do things like :</p>\n<ul>\n<li>Create triggers to perform various tasks\n<ul>\n<li>Add new rows to an excel sheet in real time with the current scores of a game. This excel sheet can then have some complex algorithms to predict which team would win by performing calculations on all the rows. Although it can be done with implementation in even NodeJS but we don't want to take the pain to port the functions/macros from Excel to JS</li>\n</ul>\n</li>\n<li>Log the current changes made by the user XYZ in the database</li>\n</ul>\n<p>The possibilities are limitless. I guess you already have a use case in mind and landing to this page to know the process, if not it's always good to know if there is possibility to get a certain functionality done.</p>\n<h1>Python and COM</h1>\n<p>We will need the following tools to communicate with MS-Word :</p>\n<ul>\n<li>MS Office or Specific applications already installed</li>\n<li><a href=\"https://pypi.python.org/pypi/pywin32\">PyWin32 library</a></li>\n</ul>\n<p><code>PyWin32</code> is a great library that gives us the same set of methods/properties that are exposed by COM which are natively in Visual Basic for Applications (VBA).</p>\n<blockquote>\n<p>NOTE: I'm using Python3 in the code samples in this guide.</p>\n</blockquote>\n<h2>Let's start</h2>\n<p>To get hold of a COM object</p>\n<pre><code class=\"language-python\">import win32com.client\n\n# for MS-Word\nword = win32.gencache.EnsureDispatch('Word.Application')\n# OR\nword = win32com.client.DispatchEx('Word.Application')\n\n# for MS-Excel\nexcel = win32.gencache.EnsureDispatch('Excel.Application')\n# OR\nexcel = win32com.client.DispatchEx('Excel.Application')\n</code></pre>\n<p>There are some key differences to be noted here</p>\n<p><code>EnsureDispatch</code> : In dead simple terms, it makes sure that a object which references the specified application is returned. If the application is already open, it will return the same instance, if not it will start a instance and return it.\nIt is useful in cases where you would want to make use of single application that holds certain meta-data, over the life of the process.</p>\n<p><code>DispatchEx</code> : For each call, you would get a new object returned. This would mean that if you call it 7 times, you would see 7 instances of MS-Word in task manager.\nIt makes sense to get independent instances when you would want to handle each process independently and close the application when one process completes.</p>\n<blockquote>\n<p>Understand that if you run a web-server that takes in data, puts it in an Excel, runs a macro and return a result. You would want to have a dedicated instance of Excel for each process so that you can close it as soon as the response is ready. If you used <code>EnsureDispatch</code> or <code>Dispatch</code>, that would mean that at the end of each process, you would have to check if any other process is in progress, if not shut down the application.</p>\n</blockquote>\n<blockquote>\n<p>It's requires a bit extra memory but helps to keep memory leak in check as using same application instance to load up multiple files that do not require each others data, means that with each load, some meta-data is loaded which is not cleared when closing the process and it builds up over time. <em>We will cover this aspect in detail in the Part-2 of the post.</em></p>\n</blockquote>\n<p>Coming back to the point, let's go ahead.</p>\n<p>Now that we have the <code>COMobject</code> we can use it a open a Word Document.</p>\n<pre><code class=\"language-python\">doc = word.Documents.Open( os.path.join( os.getcwd(), 'path/to/files/', filename), ReadOnly=True)\n</code></pre>\n<blockquote>\n<p>NOTE : As you might have had guessed, you can use the same <code>word</code> object to open multiple <code>doc</code> objects. This is what I was referring to using same application to open multiple documents in the last paragraph</p>\n</blockquote>\n<h2>References</h2>\n<p>At this point, we can refer to Microsoft's documentation to get gist of various properties &#x26; functions available.</p>\n<ul>\n<li><a href=\"https://msdn.microsoft.com/en-us/library/bb244391(v=office.12).aspx\"><strong>Word 2007 Developers Reference</strong></a></li>\n<li><a href=\"https://msdn.microsoft.com/en-us/library/bb244515(v=office.12).aspx\"><strong>Word Object Model reference</strong></a></li>\n<li><a href=\"https://msdn.microsoft.com/en-us/library/bb244569(v=office.12).aspx\"><strong>Application Object</strong></a> : List of methods and properties available</li>\n</ul>\n<h2>Let's have look at some usage examples:</h2>\n<ol>\n<li>\n<p>Make the application window invisible :</p>\n<pre><code class=\"language-python\">word.Visible = False\n</code></pre>\n</li>\n<li>\n<p>To add a new Document</p>\n<pre><code class=\"language-python\">doc = word.Documents.Add()\n</code></pre>\n</li>\n<li>\n<p>To get all the grammatical or spelling errors</p>\n<pre><code class=\"language-python\">grammaticalErrors = doc.GrammaticalErrors\nspellingErrors = doc.doc.SpellingErrors\n\n#or to simple get the count\ngrammaticalErrorsCount = doc.GrammaticalErrors.Count\nspellingErrorsCount = doc.SpellingErrors.Count\n</code></pre>\n</li>\n<li>\n<p>If you have a look at the <a href=\"https://msdn.microsoft.com/en-us/library/bb237490(v=office.12).aspx\"><strong>Word BuiltInProperty</strong></a>, you'll see you can do the following</p>\n<pre><code class=\"language-python\">wordCount = int(doc.BuiltInDocumentProperties(15))\ncharacterCount = int(doc.BuiltInDocumentProperties(16))\nparagraphCount = int(doc.BuiltInDocumentProperties(24))\n</code></pre>\n</li>\n<li>\n<p>or do something much more complex as</p>\n<pre><code class=\"language-python\">characterPerWord = doc.ReadabilityStatistics(\"Characters per Word\").Value\n</code></pre>\n</li>\n<li>\n<p>or something as simple as</p>\n<pre><code class=\"language-python\">shapeCount = doc.Shapes.Count\ntableCount = doc.Tables.Count\nsentenceCount = doc.Sentences.Count\ntableOfContentCount = doc.TablesOfContents.Count\n\n#loop through each paragraphs\nfor paras in doc.Paragraphs:\n    # paras will now be each individual paragraph\n\n</code></pre>\n</li>\n</ol>\n<h1>Conclusion</h1>\n<p>As you can see the possibilities are endless. MS-Office tools are pretty powerful in what they do. We did not even dig into the excel territory. Majority of the questions on stackoverflow are based on excel as automating tasks there makes can be of great use.</p>\n<p>In the next post we will focus on how to wrap all this up into dedicated thread for each process and word with COMobject in threads.</p>","frontmatter":{"title":"Automating windows with COM object","date":"December 01, 2018","basecolor":"#fff","author":"Mayank Raj","enablecomments":false,"category":"Tutorial","bgimage":"windows_com","external_link":null,"external_site_name":null,"external_site_link":null,"page_slug":"/blog/automation-with-windows-com"}}},"pageContext":{"slug":"/windows-com/"}},"staticQueryHashes":["1997719401","3096804680"],"slicesMap":{}}